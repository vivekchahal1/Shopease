<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShopEase</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        h1, h2 {
            color: #333;
        }
        input, button {
            padding: 8px;
            margin: 5px;
        }
        table {
            border-collapse: collapse;
            margin-top: 10px;
            width: 80%;
        }
        th, td {
            border: 1px solid #999;
            padding: 8px;
            text-align: left;
        }
        th {
            background: #eee;
        }
        .section {
            background: #fff;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            box-shadow: 0 0 5px #ccc;
        }
    </style>
</head>
<body>

    <h1>ShopEase Demo</h1>

    <div class="section">
        <h2>Add Product</h2>
        <input type="text" id="productName" placeholder="Product Name">
        <input type="number" id="productPrice" placeholder="Price">
        <button onclick="addProduct()">Add Product</button>
    </div>

    <div class="section">
        <h2>Products List</h2>
        <button onclick="loadProducts()">Refresh Products</button>
        <table id="productsTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Price</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <div class="section">
        <h2>Place Order</h2>
        <input type="text" id="orderProductIds" placeholder="Product IDs (comma-separated)">
        <button onclick="placeOrder()">Place Order</button>
    </div>

    <div class="section">
        <h2>Order History</h2>
        <button onclick="loadOrders()">Refresh Orders</button>
        <table id="ordersTable">
            <thead>
                <tr>
                    <th>Order ID</th>
                    <th>Products</th>
                    <th>Total</th>
                    <th>Time</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

<script>
const API_URL = "http://localhost:8080/api";

async function addProduct() {
    const name = document.getElementById("productName").value;
    const price = parseFloat(document.getElementById("productPrice").value);
    if(!name || !price) return alert("Enter name and price");
    
    const res = await fetch(`${API_URL}/products`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, price })
    });
    alert("Product added!");
    document.getElementById("productName").value = "";
    document.getElementById("productPrice").value = "";
    loadProducts();
}

async function loadProducts() {
    const res = await fetch(`${API_URL}/products`);
    const products = await res.json();
    const tbody = document.getElementById("productsTable").querySelector("tbody");
    tbody.innerHTML = "";
    products.forEach(p => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${p.id}</td><td>${p.name}</td><td>${p.price}</td>`;
        tbody.appendChild(tr);
    });
}

async function placeOrder() {
    const ids = document.getElementById("orderProductIds").value.split(",").map(i => parseInt(i));
    if(ids.length === 0) return alert("Enter product IDs");
    
    const res = await fetch(`${API_URL}/orders`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(ids)
    });
    alert("Order placed!");
    document.getElementById("orderProductIds").value = "";
    loadOrders();
}

async function loadOrders() {
    const res = await fetch(`${API_URL}/orders`);
    const orders = await res.json();
    const tbody = document.getElementById("ordersTable").querySelector("tbody");
    tbody.innerHTML = "";
    orders.forEach(o => {
        const productsList = o.products.map(p => p.name).join(", ");
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${o.id}</td><td>${productsList}</td><td>${o.total}</td><td>${new Date(o.orderTime).toLocaleString()}</td>`;
        tbody.appendChild(tr);
    });
}

// Initial load
loadProducts();
loadOrders();
</script>

</body>
</html>
